# ğŸš€ Render Deployment Guide for VehicleRent Kenya API

## âœ… Fixed Issues
- **ESLint Dependency Conflicts**: Resolved by downgrading to compatible versions
- **Peer Dependencies**: Added `.npmrc` files with `legacy-peer-deps=true`
- **Database Configuration**: Updated to use PostgreSQL for production
- **Build Process**: Added proper build scripts and environment handling

## ğŸ“‹ Pre-Deployment Checklist

### 1. Repository Setup
- âœ… Push all changes to your GitHub repository
- âœ… Ensure `apps/api` folder contains all necessary files
- âœ… Verify `.npmrc` files are committed

### 2. Environment Variables
Set these in Render dashboard:
```bash
NODE_ENV=production
JWT_SECRET=your-super-secret-jwt-key-here-make-it-long-and-random
JWT_REFRESH_SECRET=your-super-secret-refresh-key-here-different-from-jwt
PORT=10000
```

## ğŸ”§ Render Configuration

### Option 1: Using Render Dashboard (Recommended)

1. **Create New Web Service**
   - Go to [Render Dashboard](https://dashboard.render.com)
   - Click "New" â†’ "Web Service"
   - Connect your GitHub repository

2. **Service Configuration**
   ```
   Name: vehiclerent-api
   Environment: Node
   Region: Choose closest to your users
   Branch: main (or your main branch)
   Root Directory: apps/api
   ```

3. **Build & Deploy Settings**
   ```
   Build Command: npm install --legacy-peer-deps && npm run build
   Start Command: npm run start
   ```

4. **Environment Variables**
   Add the variables listed above in the Environment section

5. **Database Setup**
   - Create a new PostgreSQL database in Render
   - Copy the connection string to `DATABASE_URL` environment variable

### Option 2: Using render.yaml (Alternative)

If you prefer infrastructure as code, use the `render.yaml` file in the root directory.

## ğŸ—„ï¸ Database Migration

After deployment, your database will be automatically migrated thanks to the `postinstall` script in `package.json`.

## ğŸ” Troubleshooting

### Common Issues & Solutions

1. **Build Fails with ESLint Errors**
   ```bash
   # Solution: The .npmrc file should handle this
   # If it persists, add this to build command:
   npm install --legacy-peer-deps --ignore-scripts
   ```

2. **Prisma Client Not Generated**
   ```bash
   # The postinstall script should handle this
   # Manual fix: Add to build command:
   && npx prisma generate
   ```

3. **Database Connection Issues**
   - Verify `DATABASE_URL` is set correctly
   - Ensure database is in the same region as your service

4. **CORS Issues**
   - Update `FRONTEND_URL` environment variable with your frontend domain
   - The API automatically allows this origin

## ğŸ“Š Monitoring

### Health Check
Your API includes a health check endpoint at `/` that returns:
```json
{
  "message": "VehicleRent Kenya API is running!",
  "timestamp": "2024-02-05T08:00:00.000Z",
  "environment": "production"
}
```

### Logs
Monitor your application logs in the Render dashboard for any issues.

## ğŸš€ Deployment Steps

1. **Push to GitHub**
   ```bash
   git add .
   git commit -m "Fix ESLint conflicts for Render deployment"
   git push origin main
   ```

2. **Create Render Service**
   - Follow Option 1 above
   - Wait for build to complete (5-10 minutes)

3. **Test Deployment**
   - Visit your Render URL
   - Should see the health check response
   - Test API endpoints with Postman/curl

4. **Update Frontend**
   - Update your frontend's API URL to point to Render
   - Deploy frontend to Vercel/Netlify

## ğŸ” Security Notes

- JWT secrets are auto-generated by Render if not provided
- Database credentials are managed by Render
- HTTPS is automatically enabled
- Environment variables are encrypted

## ğŸ“ˆ Performance

- Free tier: 512MB RAM, shared CPU
- Upgrade to paid plans for better performance
- Consider adding Redis for caching (separate service)

## ğŸ¯ Next Steps After Deployment

1. **Test All Endpoints**
   - Authentication (OTP)
   - Vehicle CRUD
   - File uploads
   - Booking system

2. **Update Frontend Configuration**
   - Change API_BASE_URL to your Render URL
   - Test complete user flows

3. **Monitor Performance**
   - Check response times
   - Monitor error rates
   - Set up alerts

## ğŸ“ Support

If you encounter issues:
1. Check Render build logs
2. Verify environment variables
3. Test database connectivity
4. Review API health check endpoint

Your API should now be successfully deployed on Render! ğŸ‰